<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Story</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="../../assets/style.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
  <!-- Skeleton Loader -->
  <div id="imgSkeleton" class="skeleton"></div>
  <!-- Article Image -->
  <img id="articleImg" alt="Article Image" class="article-img" draggable="false">

  <!-- Progress Bar -->
  <div class="progress mt-3" style="height: 10px;">
    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
  </div>

  <!-- Article Content -->
  <div class="article-box mt-3"></div>
</div>

<!-- Congratulations Modal -->
<div class="modal fade" id="congratsModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <img src="https://cdn-icons-png.flaticon.com/512/4319/4319104.png" alt="Congrats" class="congrats-img">
      <h3 class="text-success"><i class="bi bi-trophy-fill"></i> Congratulations!</h3>
      <p class="mt-2">ðŸŽ‰ You have completed reading the full article ðŸŽ‰</p>
      <div class="d-flex justify-content-center gap-3 mt-3">
        <a href="../../index.html" class="btn secondary"> Back to Home </a>
        <button type="button" class="btn success" data-bs-dismiss="modal"> Continue </button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>

   async function loadStoryData() {
  try {
    // Get story folder path dynamically
    const currentPath = window.location.pathname;
    const storyFolder = currentPath.substring(0, currentPath.lastIndexOf("/"));
    const jsonPath = `${storyFolder}/data.json`;

    const response = await fetch(jsonPath);
    if (!response.ok) throw new Error("Failed to load story data");

    const data = await response.json();
    renderStory(data);

  } catch (err) {
    console.error("Error loading story data:", err);
  }
}

function renderStory(data) {
  // Update page title
  document.title = data.title;

  // Image loader
  const img = document.getElementById("articleImg");
  const skeleton = document.getElementById("imgSkeleton");
  img.src = data.image;
  img.onload = function() {
    skeleton.style.display = "none";
    img.style.display = "block";
  };

  // Add parts
  const container = document.querySelector(".article-box");
  container.innerHTML = data.parts.map((part, i) => `
    <div class="article-part ${i === 0 ? 'active' : ''}" id="part${i+1}">
      <h4>${part.heading}</h4>
      <p>${part.text}</p>
    </div>
  `).join("");

  // Add nav buttons
  container.innerHTML += `
    <div class="nav-btns">
      <button id="prevBtn" class="btn btn-custom-prev" disabled>
        <i class="bi bi-arrow-left-circle"></i> Previous
      </button>
      <button id="nextBtn" class="btn btn-custom-next">
        Next <i class="bi bi-arrow-right-circle"></i>
      </button>
    </div>
  `;

  setupNavigation();
}

function setupNavigation() {
  const parts = document.querySelectorAll(".article-part");
  let currentPart = 0;

  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const progressBar = document.getElementById("progressBar");
  const congratsModalEl = document.getElementById("congratsModal");
  const congratsModal = new bootstrap.Modal(congratsModalEl);

  function showPart(index) {
    parts[currentPart].classList.remove("active");
    setTimeout(() => {
      parts.forEach(part => part.classList.remove("active"));
      parts[index].classList.add("active");
      currentPart = index;

      prevBtn.disabled = index === 0;
      nextBtn.disabled = index === parts.length - 1;

      let progress = ((index + 1) / parts.length) * 100;
      progressBar.style.width = progress + "%";

      if (index === parts.length - 1) {
        setTimeout(() => congratsModal.show(), 500);
      }
    }, 150);
  }

  prevBtn.addEventListener("click", () => {
    if (currentPart > 0) showPart(currentPart - 1);
  });

  nextBtn.addEventListener("click", () => {
    if (currentPart < parts.length - 1) showPart(currentPart + 1);
  });

  congratsModalEl.addEventListener("hidden.bs.modal", () => {
    showPart(0);
  });

  showPart(currentPart);
}

document.addEventListener("DOMContentLoaded", loadStoryData);

  
</script>
</body>
</html>
